<!DOCTYPE html>
{% autoescape true %}
<html>
<head>
    <link type="text/css" rel="stylesheet" href="/stylesheets/main.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="/scripts/edit_page.js"></script>

<script type="text/javascript">

function edit_save (field_name) {
  edit_save_finish (field_name, true);
/*
  if (edit_field_changed(field_name)) {
    edit_save_finish (field_name, true);
    return;
  }

  $.ajax (
    {
      type: "POST", // POST or GET
      url: "ajax",
      dataType: "json",
      data: {
        request_id: "client.update_client_field",
        client_id: 0,
        field: field_name,
        value: document.getElementById(field_name).value
      }
    }
  ).done ( function (response)
    {
      if (response.status == 0) {
        // all good
        edit_save_finish (field_name, true);
      } else {
        // error
        edit_save_finish (field_name, false);
      }
    }
  )
*/
}

function toggle_add_note ()
{
    $("#add-note").toggle ("show");
    $("#down-arrow").toggle ("show");
    $("#up-arrow").toggle ("show");

    document.getElementById ("custom").value = $("#custom-search").is (":visible");
}

</script>

{% set proj_colors = {"Completed": "#00FF00", "In progress": "#FFFF00", "Overdue": "#FF0000"} %}

</head>
<body>

<div id="content">
  <table class="form-table">
    <tr>
      <td>
        <h1>General Info
          <a id="edit-page-enable-btn" href="javascript:edit_page_enable ()">
            <span class="edit-icon entypo-pencil scnd-font-color"></span>
          </a>
          <a id="edit-page-disable-btn" href="javascript:edit_page_disable ()" style="display:none;">
            <span class="edit-icon fontawesome-remove scnd-font-color"></span>
          </a>
        </h1>
      </td>
      <td style="text-align:right;"><h1>{{ data.general.client_name }}</h1></td>
    </tr>
    <tr>
      <td>
        <label style="margin-left:10px">Consultant</label>
        
        <select id="consultant" style="margin-left:10px; width:150px" disabled>
          {% for id, cons in data.general.consultants.iteritems () %}
            <option value="{{ id }}" {% if id == data.general.consultant %} selected {% endif %}>{{ cons.name }}</option>
          {% endfor %}
        </select>

        <a class="edit-field-enable-btn" id="consultant-edit-btn" href="javascript:edit_enable ('consultant')" style="display:none;">
          <span class="edit-icon entypo-pencil scnd-font-color"></span>
        </a>
        <a class="edit-field-save-btn" id ="consultant-save-btn" href="javascript:edit_save ('consultant')" style="display:none;">
          <span class="edit-icon fontawesome-ok scnd-font-color"></span>
        </a>
        <a class="edit-field-cancel-btn" id="consultant-cancel-btn" href="javascript:edit_cancel ('consultant')" style="display:none;">
          <span class="edit-icon fontawesome-remove scnd-font-color"></span>
        </a>
      </td>
      <td style="text-align:right;">
        <label style="margin-left:10px">Ref</label>
        <input style="margin-left:10px; width:100px" type="text" name="id" value="{{ data.general.reference }}" disabled>
      </td>
    </tr>
  </table>
  <hr/>

  <table class="form-table" style="width: 100%">
    <tr>
      <td style="width: 50%">
        <table>
          <tr>
            <th colspan=2>Projects</th>
          </tr>
           {% for proj in data.general.projects %}
            <tr>
              <td style = "text-align: left; width: 75%"> <a href"#"><span>{{proj.title}}</span></a></td>
              <td style = "text-align: left;"><span style="color:{{proj_colors[proj.status]}}";>{{ proj.status }}</span></td>
            </tr>
          {% endfor %}
          <tr>
            <td style = "text-align: left;"><a href="#">View all {{ data.general.total_projects }} project(s)</a></td>
            <td></td>
          </tr>
        </table>
      </td>
      <td style="width: 50%">
        <table>
          <tr>
            <th colspan=2>Payments</th>
          </tr>
          <tr>
            <td style = "text-align: left;">Xero ID</td>
            <td style = "text-align: left;">
              <input style="margin-left:10px; width:100px" type="text" id="xero_id" value="{{ data.general.payments.xero_id }}" disabled>
              <a class="edit-field-enable-btn" id="xero_id-edit-btn" href="javascript:edit_enable ('xero_id')" style="display:none;">
                <span class="edit-icon entypo-pencil scnd-font-color"></span>
              </a>
              <a class="edit-field-save-btn" id ="xero_id-save-btn" href="javascript:edit_save ('xero_id')" style="display:none;">
                <span class="edit-icon fontawesome-ok scnd-font-color"></span>
              </a>
              <a class="edit-field-cancel-btn" id="xero_id-cancel-btn" href="javascript:edit_cancel ('xero_id')" style="display:none;">
                <span class="edit-icon fontawesome-remove scnd-font-color"></span>
              </a>
            </td>
          </tr>
          <tr>
            <td style = "text-align: left;">Total invoices</td>
            <td style = "text-align: left;">{{ data.general.payments.total_invoices }}</td>
          </tr>
          <tr>
            <td style = "text-align: left;">Unpaid</td>
            <td style = "text-align: left;">{{ data.general.payments.unpaid_invoices }}</td>
          </tr>
          <tr>
            <td style = "text-align: left;">Overdue</td>
            <td style = "text-align: left;">{{ data.general.payments.overdue_invoices }}</td>
          </tr>
        </table>
      </td>
    </tr>
  </table>

  <hr/>

  <div>
    <a href="javascript:toggle_add_note ()">Add note</a>
    <span id="down-arrow" class="entypo-down-open scnd-font-color" style="margin-left:5px"></span>
    <span id="up-arrow" class="entypo-up-open scnd-font-color" style="margin-left:5px;display:none"></span>
  </div>

  <div id="add-note" style="display:none">
    <textarea style="margin-top:20px; width: 100%; height: 100px" type="text"></textarea>
    <button type="button" class="submit_button" style="float:right;">Add note</button>
  </div>

  <div style= "width: 100%; height: 400px; overflow-y: scroll; border-style: ridge; border-width: 2px; margin-top:10px">
    {% for note in data.general.notes %}
      <b>{{ note.timestamp }} {{ note.user_name}}</b><br/>
      {{ note.text}}<br/><hr/>
    {% endfor %}
  </div>

</div>
</body>
</html>
{% endautoescape %}